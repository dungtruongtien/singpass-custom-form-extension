{
  "version": 3,
  "sources": ["../../../app/routes/app.qrcodes.$id.jsx"],
  "sourcesContent": ["// REMIX HMR BEGIN\nif (!window.$RefreshReg$ || !window.$RefreshSig$ || !window.$RefreshRuntime$) {\n  console.warn('remix:hmr: React Fast Refresh only works when the Remix compiler is running in development mode.');\n} else {\n  var prevRefreshReg = window.$RefreshReg$;\n  var prevRefreshSig = window.$RefreshSig$;\n  window.$RefreshReg$ = (type, id) => {\n    window.$RefreshRuntime$.register(type, \"\\\"app/routes/app.qrcodes.$id.jsx\\\"\" + id);\n  }\n  window.$RefreshSig$ = window.$RefreshRuntime$.createSignatureFunctionForTransform;\n}\nvar _s = $RefreshSig$();\nimport * as __hmr__ from \"remix:hmr\";\nif (import.meta) {\n  import.meta.hot = __hmr__.createHotContext(\n  //@ts-expect-error\n  \"app/routes/app.qrcodes.$id.jsx\");\n  import.meta.hot.lastModified = \"1692175413558.9727\";\n}\n// REMIX HMR END\n\nimport { useState } from \"react\";\nimport { json, redirect } from \"@remix-run/node\";\nimport { useActionData, useLoaderData, useNavigation, useSubmit, useNavigate } from \"@remix-run/react\";\nimport { authenticate } from \"../shopify.server\";\nimport { Card, Bleed, Button, ChoiceList, Divider, EmptyState, HorizontalStack, InlineError, Layout, Page, Text, TextField, Thumbnail, VerticalStack, PageActions } from \"@shopify/polaris\";\nimport { ImageMajor } from \"@shopify/polaris-icons\";\nimport db from \"../db.server\";\nimport { getQRCode, validateQRCode } from \"../models/QRCode.server\";\nexport async function loader({\n  request,\n  params\n}) {\n  const {\n    admin\n  } = await authenticate.admin(request);\n  console.log('admin------', admin);\n  if (params.id === \"new\") {\n    return json({\n      destination: \"product\",\n      title: \"\"\n    });\n  }\n  return json(await getQRCode(Number(params.id), admin.graphql));\n}\nexport async function action({\n  request,\n  params\n}) {\n  console.log('request, params----', request, params);\n  const {\n    session\n  } = await authenticate.admin(request);\n  const {\n    shop\n  } = session;\n  if (request.method === \"DELETE\") {\n    await db.qRCode.delete({\n      where: {\n        id: Number(params.id)\n      }\n    });\n    return redirect(\"/app\");\n  }\n\n  /** @type {any} */\n  const data = {\n    ...Object.fromEntries(await request.formData()),\n    shop\n  };\n  const errors = validateQRCode(data);\n  if (errors) {\n    return json({\n      errors\n    }, {\n      status: 422\n    });\n  }\n  const QRCode = params.id === \"new\" ? await db.qRCode.create({\n    data\n  }) : await db.qRCode.update({\n    where: {\n      id: Number(params.id)\n    },\n    data\n  });\n  return redirect(`/app/qrcodes/${QRCode.id}`);\n}\nexport default function QRCodeForm() {\n  _s();\n  const errors = useActionData()?.errors || {};\n  const QRCode = useLoaderData();\n  const [formState, setFormState] = useState(QRCode);\n  const [cleanFormState, setCleanFormState] = useState(QRCode);\n  const isDirty = JSON.stringify(formState) !== JSON.stringify(cleanFormState);\n  const nav = useNavigation();\n  const isSaving = nav.state === \"submitting\" && nav.formMethod === \"POST\";\n  const isDeleting = nav.state === \"submitting\" && nav.formMethod === \"DELETE\";\n  const navigate = useNavigate();\n  async function selectProduct() {\n    const products = await window.shopify.resourcePicker({\n      type: \"product\",\n      action: \"select\" // customized action verb, either 'select' or 'add',\n    });\n\n    if (products) {\n      const {\n        images,\n        id,\n        variants,\n        title,\n        handle\n      } = products[0];\n      console.log('products-----', JSON.stringify(products));\n      setFormState({\n        ...formState,\n        productId: id,\n        productVariantId: variants[0].id,\n        productTitle: title,\n        productHandle: handle,\n        productAlt: images[0]?.altText,\n        productImage: images[0]?.originalSrc\n      });\n    }\n  }\n  const submit = useSubmit();\n  function handleSave() {\n    const data = {\n      title: formState.title,\n      productId: formState.productId || \"\",\n      productVariantId: formState.productVariantId || \"\",\n      productHandle: formState.productHandle || \"\",\n      destination: formState.destination\n    };\n    console.log('data------', data);\n    setCleanFormState({\n      ...formState\n    });\n    submit(data, {\n      method: \"post\"\n    });\n  }\n  return <Page>\n      <ui-title-bar title={QRCode.id ? \"Edit QR code\" : \"Create new QR code\"}>\n        <button variant=\"breadcrumb\" onClick={() => navigate(\"/app\")}>\n          QR codes\n        </button>\n      </ui-title-bar>\n      <Layout>\n        <Layout.Section>\n          <VerticalStack gap=\"5\">\n            <Card>\n              <VerticalStack gap=\"5\">\n                <Text as={\"h2\"} variant=\"headingLg\">\n                  Title\n                </Text>\n                <TextField id=\"title\" helpText=\"Only store staff can see this title\" label=\"title\" labelHidden autoComplete=\"off\" value={formState.title} onChange={title => setFormState({\n                ...formState,\n                title: title\n              })} error={errors.title} />\n              </VerticalStack>\n            </Card>\n            <Card>\n              <VerticalStack gap=\"5\">\n                <HorizontalStack align=\"space-between\">\n                  <Text as={\"h2\"} variant=\"headingLg\">\n                    Product\n                  </Text>\n                  {formState.productId ? <Button plain onClick={selectProduct}>\n                      Change product\n                    </Button> : null}\n                </HorizontalStack>\n                {formState.productId ? <HorizontalStack blockAlign=\"center\" gap={\"5\"}>\n                    <Thumbnail source={formState.productImage || ImageMajor} alt={formState.productAlt} />\n                    <Text as=\"span\" variant=\"headingMd\" fontWeight=\"semibold\">\n                      {formState.productTitle}\n                    </Text>\n                  </HorizontalStack> : <VerticalStack gap=\"2\">\n                    <Button onClick={selectProduct} id=\"select-product\">\n                      Select product\n                    </Button>\n                    {errors.productId ? <InlineError message={errors.productId} fieldID=\"myFieldID\" /> : null}\n                  </VerticalStack>}\n                <Bleed marginInline=\"20\">\n                  <Divider />\n                </Bleed>\n                <HorizontalStack gap=\"5\" align=\"space-between\" blockAlign=\"start\">\n                  <ChoiceList title=\"Scan destination\" choices={[{\n                  label: \"Link to product page\",\n                  value: \"product\"\n                }, {\n                  label: \"Link to checkout page with product in the cart\",\n                  value: \"cart\"\n                }]} selected={[formState.destination]} onChange={destination => setFormState({\n                  ...formState,\n                  destination: destination[0]\n                })} error={errors.destination} />\n                  {QRCode.destinationUrl ? <Button plain url={QRCode.destinationUrl} external>\n                      Go to destination URL\n                    </Button> : null}\n                </HorizontalStack>\n              </VerticalStack>\n            </Card>\n          </VerticalStack>\n        </Layout.Section>\n        <Layout.Section secondary>\n          <Card>\n            <Text as={\"h2\"} variant=\"headingLg\">\n              QR code\n            </Text>\n            {QRCode ? <EmptyState image={QRCode.image} imageContained={true} /> : <EmptyState image=\"\">\n                Your QR code will appear here after you save\n              </EmptyState>}\n            <VerticalStack gap=\"3\">\n              <Button disabled={!QRCode?.image} url={QRCode?.image} download primary>\n                Download\n              </Button>\n              <Button disabled={!QRCode.id} url={`/qrcodes/${QRCode.id}`} external>\n                Go to public URL\n              </Button>\n            </VerticalStack>\n          </Card>\n        </Layout.Section>\n        <Layout.Section>\n          <PageActions secondaryActions={[{\n          content: \"Delete\",\n          loading: isDeleting,\n          disabled: !QRCode.id || !QRCode || isSaving || isDeleting,\n          destructive: true,\n          outline: true,\n          onAction: () => submit({}, {\n            method: \"delete\"\n          })\n        }]} primaryAction={{\n          content: \"Save\",\n          loading: isSaving,\n          disabled: !isDirty || isSaving || isDeleting,\n          onAction: handleSave\n        }} />\n        </Layout.Section>\n      </Layout>\n    </Page>;\n}\n_s(QRCodeForm, \"963hAalA8gMxyj49mNASN4nH5RQ=\", false, function () {\n  return [useActionData, useLoaderData, useNavigation, useNavigate, useSubmit];\n});\n_c = QRCodeForm;\nvar _c;\n$RefreshReg$(_c, \"QRCodeForm\");\n\nwindow.$RefreshReg$ = prevRefreshReg;\nwindow.$RefreshSig$ = prevRefreshSig;"],
  "mappings": "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",
  "names": ["_a"]
}
